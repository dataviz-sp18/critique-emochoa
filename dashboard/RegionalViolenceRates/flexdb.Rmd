---
title: 'Violence: The Role of Disadvantage by Climate Zone'
author: 'Erin M. Ochoa'
date: '2018 May 18'
class: 'Data Visualization'
professor: 'Dr. Soltoff'
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: cerulean
---

```{r setup}
library(sp)
library(rgdal)
library(leaflet)
library(htmltools)
library(RColorBrewer)
```

```{r read_data, message=FALSE, warning=FALSE,echo=FALSE,include=FALSE}
zones <- readOGR('data/climatezones_aug.shp',layer='climatezones_aug', GDAL1_integer64_policy = TRUE)
```


```{r prepare_components}
m0.bins = c(-Inf,-6.0,-1.5,-.0001,0.0001,1.5,6.0,Inf)
m0.pal <- colorBin('RdBu', domain = zones$Coef0Z, bins = m0.bins, reverse=TRUE)

m3.bins = c(-Inf,-.812,-.527,0,0.0001,.326,.611,Inf)
m3.pal <- colorBin('RdBu', domain = zones$Coef3Z, bins = m3.bins, reverse=TRUE)

m4.bins.zone = c(-Inf,-.640,-.228,-.038,0.0001,.236,.646,Inf)
m4.pal.zone <- colorBin('RdBu', domain = zones$Coef4Z, bins = m4.bins.zone, reverse=TRUE)

m4.bins.int = c(-Inf,-.236,-.059,0,0.001,0.3,0.620,Inf)
m4.pal.int <- colorBin('RdBu', domain = zones$Coef4Int, bins = m4.bins.int, reverse=TRUE)
  
m5.bins <- seq(min(zones$Coef5D),max(zones$Coef5D),by=(max(zones$Coef5D) - min(zones$Coef5D))/7)
m5.pal <- colorBin('YlOrRd', domain = zones$Coef5D, bins = m5.bins, reverse=FALSE)

m6.bins <- seq(min(zones$Coef6D),max(zones$Coef6D),by=(max(zones$Coef6D) - min(zones$Coef6D))/7)
m6.pal <- colorBin('YlOrRd', domain = zones$Coef6D, bins = m6.bins, reverse=FALSE)

m7.bins <- seq(min(zones$Coef7D),max(zones$Coef7D),by=(max(zones$Coef7D) - min(zones$Coef7D))/7)
m7.pal <- colorBin('YlOrRd', domain = zones$Coef7D, bins = m7.bins, reverse=FALSE)

base.labels <- sprintf(
  "<strong>%s</strong><br/>",
  zones$Name
) %>% lapply(HTML)

m0.labels <- sprintf(
  "<strong>%s</strong><br/>Base Coefficient:  %g",
  zones$Name, zones$Coef0Z
) %>% lapply(HTML)

m3.labels <- sprintf(
  "<strong>%s</strong><br/>Model A Zone Coefficient:  %g",
  zones$Name, zones$Coef3Z
) %>% lapply(HTML)

m4.labels <- sprintf(
  "<strong>%s</strong><br/>Model B Zone Coefficient:  %g",
  zones$Name, zones$Coef4Z
) %>% lapply(HTML)

m4.int.labels <- sprintf(
  "<strong>%s</strong><br/>Model B Zone x Disadvantage Coefficient:  %g",
  zones$Name, zones$Coef4Int
) %>% lapply(HTML)

m5.labels <- sprintf(
  "<strong>%s</strong><br/>Model C (OLS by Regimes) Disadvantage Coefficient:  %g",
  zones$Name, zones$Coef5D
) %>% lapply(HTML)

m6.labels <- sprintf(
  "<strong>%s</strong><br/>Model D (Spatial Lag by Regimes) Disadvantage Coefficient:  %g",
  zones$Name, zones$Coef6D
) %>% lapply(HTML)

m7.labels <- sprintf(
  "<strong>%s</strong><br/>Model E (Spatial Error by Regimes) Disadvantage Coefficient:  %g",
  zones$Name, zones$Coef7D
) %>% lapply(HTML)

hopts <- highlightOptions(weight = 4,
                       color = "#555555",
                       dashArray = "",
                       fillOpacity = .6,
                       bringToFront = TRUE)

lopts <- labelOptions(style = list("font-weight" = "normal"),
                      textsize = "15px",direction = "auto",opacity=1)

zones.map <- leaflet(zones,option=leafletOptions(zoomControl=TRUE,minZoom=4, maxZoom=5)) %>%
               addProviderTiles(providers$CartoDB.PositronNoLabels) %>%
               addLabelOnlyMarkers(lng = ~Lon, lat = ~Lat, label = ~as.character(zone),
                                     labelOptions = labelOptions(noHide = TRUE, direction = 'top', textOnly = TRUE,
                                                  style = list("font-size" = "14px")))
```

### Introduction {data-commentary-width=450}

<p align=center><font size=3>
Figure 1. Homicide rate per 100,000 persons by county, 1990, with Empirical Bayes smoothing
(data from <a href=https://geodacenter.github.io/data-and-lab/ncovr>Anselin 2003</a>).</font><br>
![](data/hr90_EBS_cropped.png){width=1000px}
</p>

*** 
<p align=justify><font size=4>
<b>Violence rates are higher in the South.</b><br><br>
Historically, criminologists have turned to the idea of a <i>Southern subculture of violence</i> to explain this disparity.<br><br>
But culture isn't the only factor that varies regionally: the <u>climate</u> does, too.</font></p>

### Climate Regions {data-commentary-width=450}
<p align=center><font size=3>
Figure 2. Climate regions where sampled tracts are located.</font><br>
```{r frame2}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6, fillColor = ~Color,
                                                               highlight = hopts,
                                                               label = base.labels,
                                                               labelOptions = lopts)
```
</p>
*** 

<p align=justify><font size=4>
<b>Climate varies by region.</b><br><br>
This map of distinct climate regions (Ochoa 2018) is constructed from thirty years of climate data (<a href=http://doi.org/10.7289/V5PN93JP>Arguez et al. 2010</a>).<br><br>
The National Neighborhood Crime Study (<a href=>Peterson & Krivo 2010</a>) contains data for all Census tracts in a sample of cities.<br><br>
The tracts with data for violent crime rate (averaged over 1999-2001) are located in fourteen climate regions, as shown in Figure 2.
</font></p>

### Raw Violence Rates {data-commentary-width=450}
<p align=center><font size=3>
Figure 3. Climate-region coefficient, relative to region 1 (Great Lakes), for violent crime rate of the sampled tracts in each region.</font><br>
```{r frame3}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6, fillColor = ~m0.pal(zones$Coef0Z),
                                                                highlight = hopts,
                                                                label = m0.labels,
                                                                labelOptions = lopts) %>%
                                                addLegend(pal=m0.pal, values=~zones$Coef0Z, opacity = 0.7, title = NULL,position='bottomright')
```
</p>
*** 
<p align=justify><font size=4>
<b>Violence rates vary by climate region.</b><br><br>
Figure 3 shows the climate-region coefficient, relative to region 1 (Great Lakes, in white), for the violent crime rate of the sampled tracts in each region.<br><br>
Note that tracts in some Southern regions (like 6, 11, and 18) have higher violence rates on average than tracts in the Great Lakes region, but tracts in other Southern regions (like 8, 10, and 14) have lower violence rates.<br><br>
This shows that the South is <u>not homogeneous</u>: there is variability across climate regions within the South.<br><br>
Also note that tracts in region 3 have higher violence rates on average than those in the Great Lakes region. 
</font></p>
### Model A: Climate Zone {data-commentary-width=450}
<p align=center><font size=3>
Figure 4. Model A: Climate-region coefficient, relative to region 1 (Great Lakes), for violent crime rate of the sampled tracts in each region.</font><br>
```{r frame4}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6, fillColor = ~m3.pal(zones$Coef3Z),
                                                            highlight = hopts,
                                                            label = m3.labels,
                                                            labelOptions = lopts) %>%
                                                addLegend(pal=m3.pal, values=~zones$Coef3Z, opacity = 0.7, title = NULL,position='bottomright')
```
</p>
***
<p align=justify><font size=4>
<b>Controlling for theoretically and empirically indicated covariates changes the association between climate and violence.</b><br><br>
Figure 4 shows the climate-region coefficient, relative to region 1 (Great Lakes), for violent crime rate of the sampled tracts in each region after controlling for tract- and city-level covariates.<br><br>
This shows that once such conditions are taken into account, there are tracts in areas of the South that have low levels of violence (like in regions 8, 10, and 14) and tracts in areas outside the South that have high levels of violence (like in regions 5 and 12).<br><br>
<u>Tract-level covariates</u>:<ul><li>Residential Instability</li> <li>Immigrant Prevalence</li> <li>Disadvantage</li> <li>Males Aged 15&ndash;34</li> <li>Percent Minority</li></ul>
<u>City-level covariates</u>:<ul><li>Segregation</li><li>Disadvantage</li><li>Manufacturing Jobs</li><li>Population</li><li>Percent Minority</li><li>Percent Recent Movers</li><li>Percent Foreign-Born</li><li>Males Aged 15&ndash;34</li></ul>
</font></p>

### Model B: Climate Zone<br>(when Disadvantage  = 0) {data-commentary-width=450}
<p align=center><font size=3>
Figure 5. Model B: Climate-region coefficient (when disadvantage = 0), relative to region 1, for violent crime rate of the sampled tracts in each region.</font><br>
```{r frame5}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6,
                                                            fillColor = ~m4.pal.zone(zones$Coef4Z),
                                                            highlight = hopts,
                                                            label = m4.labels,
                                                            labelOptions = lopts) %>%
                                                addLegend(pal=m4.pal.zone, values=~zones$Coef4Z, opacity = 0.7, title = NULL,position='bottomright')
```
</p>
*** 
<p align=justify><font size=4>
<b>In the absence of disadvantage, tracts in some subregions of the South exhibit high levels of violence&mdash;but tracts in other subregions have lower violence rates.</b><br><br>
Controlling for the interaction of climate region and disadvantage allows the measurement of the association between climate region and violence when disadvantage is equal to zero.<br><br>
Figure 5 shows that the association between climate region and violence is very high for tracts in zone 18, the Lower South, but also for tracts in zone 5, the Pacific Northwest.<br><br>
Furthermore, several Southern subregions have much lower violence rates under such conditions.<br><br>
Together, these findings call into question the existence of a Southern subculture of violence.
</font></p>

### Model B: Climate Zone x Disadvantage {data-commentary-width=450}
<p align=center><font size=3>
Figure 6. Model B: Coefficient for the interaction between climate region and disadvantage, relative to region 1, for violent crime rate of the sampled tracts in each region.</font><br>
```{r frame6}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6,
                                                                fillColor = ~m4.pal.int(zones$Coef4Int),
                                                                highlight = hopts,
                                                                label = m4.int.labels,
                                                                labelOptions = lopts) %>%
                                                    addLegend(pal=m4.pal.int, values=~zones$Coef4Int, opacity = 0.7, title = NULL,position='bottomright')
```

***
<p align=justify><font size=4>
<b>Climate moderates the relationship between disadvantage and violence.</b><br><br>
<br><br>
The results indicate that no matter the climate, disadvantage is positively related to violent crime, though the size of the effect varies by climate region.
</font></p>

### Model C: OLS by Climate Regions (Disadvantage) {data-commentary-width=450}

```{r frame7}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6,
                                                            fillColor = ~m5.pal(zones$Coef5D),
                                                            highlight = hopts,
                                                            label = m5.labels,
                                                            labelOptions = lopts) %>%
                                                addLegend(pal=m5.pal, values=~zones$Coef5D, opacity = 0.7, title = NULL,position='bottomright')
```

*** 

Text

### Model D: Spatial Lag by Regions (Disadvantage) {data-commentary-width=450}

```{r frame8}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6,
                                                            fillColor = ~m6.pal(zones$Coef6D),
                                                            highlight = hopts,
                                                            label = m6.labels,
                                                            labelOptions = lopts) %>%
                                                addLegend(pal=m6.pal, values=~zones$Coef6D, opacity = 0.7, title = NULL,position='bottomright')
```

*** 

Text

### Model E: Spatial Error by Regions (Disadvantage) {data-commentary-width=450}

```{r frame9}
zones.map %>% addPolygons(weight = 1, color = '#000000',opacity = 1.0,fill=TRUE,fillOpacity = 0.6,
                                                            fillColor = ~m7.pal(zones$Coef7D),
                                                            highlight = hopts,
                                                            label = m7.labels,
                                                            labelOptions = lopts) %>%
                                                addLegend(pal=m7.pal, values=~zones$Coef7D, opacity = 0.7, title = NULL,position='bottomright')
```

*** 

Text